{"version":3,"names":["useEffect","useMemo","useState","Skia","FontSlant","Platform","useTypeface","defaultFontSize","useFont","font","size","onError","typeface","Font","defaultFontStyle","fontFamily","fontSize","fontStyle","fontWeight","slant","s","Italic","Oblique","Upright","weight","parseInt","matchFont","inputStyle","fontMgr","FontMgr","System","style","width","matchFamilyStyle","listFontFamilies","families","Set","i","countFamilies","add","getFamilyName","Array","from","loadTypefaces","typefacesToLoad","promises","Object","keys","flatMap","familyName","map","typefaceToLoad","Data","fromURI","resolveAsset","then","data","tf","Typeface","MakeFreeTypeFaceFromData","Error","Promise","all","useFonts","sources","setFontMgr","result","fMgr","TypefaceFontProvider","Make","forEach","registerFont"],"sources":["Font.ts"],"sourcesContent":["/*global SkiaApi*/\nimport { useEffect, useMemo, useState } from \"react\";\n\nimport { Skia } from \"../Skia\";\nimport { FontSlant } from \"../types\";\nimport type { DataModule, DataSourceParam, SkFontMgr } from \"../types\";\nimport { Platform } from \"../../Platform\";\nimport type { SkTypefaceFontProvider } from \"../types/Paragraph/TypefaceFontProvider\";\n\nimport { useTypeface } from \"./Typeface\";\n\nconst defaultFontSize = 14;\n\n/**\n * Returns a Skia Font object\n * */\nexport const useFont = (\n  font: DataSourceParam,\n  size = defaultFontSize,\n  onError?: (err: Error) => void\n) => {\n  const typeface = useTypeface(font, onError);\n  return useMemo(() => {\n    if (typeface) {\n      return Skia.Font(typeface, size);\n    } else {\n      return null;\n    }\n  }, [size, typeface]);\n};\n\ntype Slant = \"normal\" | \"italic\" | \"oblique\";\ntype Weight =\n  | \"normal\"\n  | \"bold\"\n  | \"100\"\n  | \"200\"\n  | \"300\"\n  | \"400\"\n  | \"500\"\n  | \"600\"\n  | \"700\"\n  | \"800\"\n  | \"900\";\n\ninterface RNFontStyle {\n  fontFamily: string;\n  fontSize: number;\n  fontStyle: Slant;\n  fontWeight: Weight;\n}\n\nconst defaultFontStyle: RNFontStyle = {\n  fontFamily: \"System\",\n  fontSize: defaultFontSize,\n  fontStyle: \"normal\",\n  fontWeight: \"normal\",\n};\n\nconst slant = (s: Slant) => {\n  if (s === \"italic\") {\n    return FontSlant.Italic;\n  } else if (s === \"oblique\") {\n    return FontSlant.Oblique;\n  } else {\n    return FontSlant.Upright;\n  }\n};\n\nconst weight = (fontWeight: Weight) => {\n  switch (fontWeight) {\n    case \"normal\":\n      return 400;\n    case \"bold\":\n      return 700;\n    default:\n      return parseInt(fontWeight, 10);\n  }\n};\n\nexport const matchFont = (\n  inputStyle: Partial<RNFontStyle> = {},\n  fontMgr: SkFontMgr = Skia.FontMgr.System()\n) => {\n  const fontStyle = {\n    ...defaultFontStyle,\n    ...inputStyle,\n  };\n  const style = {\n    weight: weight(fontStyle.fontWeight),\n    width: 5,\n    slant: slant(fontStyle.fontStyle),\n  };\n  const typeface = fontMgr.matchFamilyStyle(fontStyle.fontFamily, style);\n  return Skia.Font(typeface, fontStyle.fontSize);\n};\n\nexport const listFontFamilies = (\n  fontMgr: SkFontMgr = Skia.FontMgr.System()\n) => {\n  const families = new Set<string>();\n  for (let i = 0; i < fontMgr.countFamilies(); i++) {\n    families.add(fontMgr.getFamilyName(i));\n  }\n  return Array.from(families);\n};\n\nconst loadTypefaces = (typefacesToLoad: Record<string, DataModule[]>) => {\n  const promises = Object.keys(typefacesToLoad).flatMap((familyName) => {\n    return typefacesToLoad[familyName].map((typefaceToLoad) => {\n      return Skia.Data.fromURI(Platform.resolveAsset(typefaceToLoad)).then(\n        (data) => {\n          const tf = Skia.Typeface.MakeFreeTypeFaceFromData(data);\n          if (tf === null) {\n            throw new Error(`Couldn't create typeface for ${familyName}`);\n          }\n          return [familyName, tf] as const;\n        }\n      );\n    });\n  });\n  return Promise.all(promises);\n};\n\nexport const useFonts = (sources: Record<string, DataModule[]>) => {\n  const [fontMgr, setFontMgr] = useState<null | SkTypefaceFontProvider>(null);\n\n  useEffect(() => {\n    loadTypefaces(sources).then((result) => {\n      const fMgr = Skia.TypefaceFontProvider.Make();\n      result.forEach(([familyName, typeface]) => {\n        fMgr.registerFont(typeface, familyName);\n      });\n      setFontMgr(fMgr);\n    });\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  return fontMgr;\n};\n"],"mappings":"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","ignoreList":[]}