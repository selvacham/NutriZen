{"version":3,"names":["_react","_interopRequireWildcard","require","_JsiSkSurface","_Platform","_SkiaViewNativeId","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_extends","assign","bind","arguments","length","apply","_defineProperty","_toPropertyKey","value","enumerable","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","dp2Pixel","pd","rect","undefined","x","y","width","height","WebGLRenderer","constructor","canvas","onResize","makeImageSnapshot","picture","surface","getCanvas","clear","CanvasKit","TRANSPARENT","draw","ref","flush","clientWidth","clientHeight","MakeWebGLCanvasSurface","ctx","getContext","drawingBufferColorSpace","Error","JsiSkSurface","Float32Array","of","save","scale","drawPicture","restore","dispose","_this$canvas","getExtension","loseContext","delete","StaticWebGLRenderer","cachedImage","renderPictureToSurface","tempCanvas","OffscreenCanvas","webglSurface","skiaCanvas","error","cleanupWebGLContext","renderResult","ctx2d","drawImage","console","_this$cachedImage","Platform","PixelRatio","SkiaPictureView","props","canvasRef","useRef","renderer","redrawRequestsRef","requestIdRef","pictureRef","onLayout","redraw","useCallback","current","getSize","_canvasRef$current","_canvasRef$current2","setPicture","newPicture","measure","callback","getBoundingClientRect","parentElement","offsetParent","parentRect","left","top","pageX","window","scrollX","pageY","scrollY","measureInWindow","tick","requestAnimationFrame","onLayoutEvent","evt","__destroyWebGLContextAfterRender","useImperativeHandle","useEffect","_props$nativeID","nativeID","SkiaViewNativeId","global","SkiaViewApi","registerView","cancelAnimationFrame","debug","_ref","viewProps","createElement","View","style","display","exports"],"sources":["SkiaPictureView.web.tsx"],"sourcesContent":["/* global HTMLCanvasElement */\nimport React, {\n  useRef,\n  useEffect,\n  useCallback,\n  useImperativeHandle,\n} from \"react\";\nimport type { LayoutChangeEvent } from \"react-native\";\n\nimport type { SkRect, SkPicture, SkImage } from \"../skia/types\";\nimport { JsiSkSurface } from \"../skia/web/JsiSkSurface\";\nimport { Platform } from \"../Platform\";\nimport type { ISkiaViewApiWeb } from \"../specs/NativeSkiaModule.web\";\n\nimport type { SkiaPictureViewNativeProps } from \"./types\";\nimport { SkiaViewNativeId } from \"./SkiaViewNativeId\";\n\nconst dp2Pixel = (pd: number, rect?: SkRect) => {\n  if (!rect) {\n    return undefined;\n  }\n  return {\n    x: rect.x * pd,\n    y: rect.y * pd,\n    width: rect.width * pd,\n    height: rect.height * pd,\n  };\n};\n\ninterface Renderer {\n  onResize(): void;\n  draw(picture: SkPicture): void;\n  makeImageSnapshot(picture: SkPicture, rect?: SkRect): SkImage | null;\n  dispose(): void;\n}\n\nclass WebGLRenderer implements Renderer {\n  private surface: JsiSkSurface | null = null;\n\n  constructor(\n    private canvas: HTMLCanvasElement,\n    private pd: number\n  ) {\n    this.onResize();\n  }\n\n  makeImageSnapshot(picture: SkPicture, rect?: SkRect): SkImage | null {\n    if (!this.surface) {\n      return null;\n    }\n    const canvas = this.surface.getCanvas();\n    canvas!.clear(CanvasKit.TRANSPARENT);\n    this.draw(picture);\n    this.surface.ref.flush();\n    return this.surface.makeImageSnapshot(dp2Pixel(this.pd, rect));\n  }\n\n  onResize() {\n    const { canvas, pd } = this;\n    canvas.width = canvas.clientWidth * pd;\n    canvas.height = canvas.clientHeight * pd;\n    const surface = CanvasKit.MakeWebGLCanvasSurface(canvas);\n    const ctx = canvas.getContext(\"webgl2\");\n    if (ctx) {\n      ctx.drawingBufferColorSpace = \"display-p3\";\n    }\n    if (!surface) {\n      throw new Error(\"Could not create surface\");\n    }\n    this.surface = new JsiSkSurface(CanvasKit, surface);\n  }\n\n  draw(picture: SkPicture) {\n    if (this.surface) {\n      const canvas = this.surface.getCanvas();\n      canvas.clear(Float32Array.of(0, 0, 0, 0));\n      canvas.save();\n      canvas.scale(pd, pd);\n      canvas.drawPicture(picture);\n      canvas.restore();\n      this.surface.ref.flush();\n    }\n  }\n\n  dispose(): void {\n    if (this.surface) {\n      this.canvas\n        ?.getContext(\"webgl2\")\n        ?.getExtension(\"WEBGL_lose_context\")\n        ?.loseContext();\n      this.surface.ref.delete();\n      this.surface = null;\n    }\n  }\n}\n\nclass StaticWebGLRenderer implements Renderer {\n  private cachedImage: SkImage | null = null;\n\n  constructor(\n    private canvas: HTMLCanvasElement,\n    private pd: number\n  ) {}\n\n  onResize(): void {\n    this.cachedImage = null;\n  }\n\n  private renderPictureToSurface(\n    picture: SkPicture\n  ): { surface: JsiSkSurface; tempCanvas: OffscreenCanvas } | null {\n    const tempCanvas = new OffscreenCanvas(\n      this.canvas.clientWidth * this.pd,\n      this.canvas.clientHeight * this.pd\n    );\n\n    let surface: JsiSkSurface | null = null;\n\n    try {\n      const webglSurface = CanvasKit.MakeWebGLCanvasSurface(tempCanvas);\n      const ctx = tempCanvas.getContext(\"webgl2\");\n      if (ctx) {\n        ctx.drawingBufferColorSpace = \"display-p3\";\n      }\n\n      if (!webglSurface) {\n        throw new Error(\"Could not create WebGL surface\");\n      }\n\n      surface = new JsiSkSurface(CanvasKit, webglSurface);\n\n      const skiaCanvas = surface.getCanvas();\n      skiaCanvas.clear(Float32Array.of(0, 0, 0, 0));\n      skiaCanvas.save();\n      skiaCanvas.scale(this.pd, this.pd);\n      skiaCanvas.drawPicture(picture);\n      skiaCanvas.restore();\n      surface.ref.flush();\n\n      return { surface, tempCanvas };\n    } catch (error) {\n      if (surface) {\n        surface.ref.delete();\n      }\n      this.cleanupWebGLContext(tempCanvas);\n      return null;\n    }\n  }\n\n  private cleanupWebGLContext(tempCanvas: OffscreenCanvas): void {\n    const ctx = tempCanvas.getContext(\"webgl2\");\n    if (ctx) {\n      const loseContext = ctx.getExtension(\"WEBGL_lose_context\");\n      if (loseContext) {\n        loseContext.loseContext();\n      }\n    }\n  }\n\n  draw(picture: SkPicture): void {\n    const renderResult = this.renderPictureToSurface(picture);\n    if (!renderResult) {\n      return;\n    }\n    const { tempCanvas } = renderResult;\n    const ctx2d = this.canvas.getContext(\"2d\");\n    if (!ctx2d) {\n      throw new Error(\"Could not get 2D context\");\n    }\n\n    // Set canvas dimensions to match pixel density\n    this.canvas.width = this.canvas.clientWidth * this.pd;\n    this.canvas.height = this.canvas.clientHeight * this.pd;\n\n    // Draw the tempCanvas scaled down to the display size\n    ctx2d.drawImage(\n      tempCanvas,\n      0,\n      0,\n      tempCanvas.width,\n      tempCanvas.height,\n      0,\n      0,\n      this.canvas.clientWidth * this.pd,\n      this.canvas.clientHeight * this.pd\n    );\n\n    this.cleanupWebGLContext(tempCanvas);\n  }\n\n  makeImageSnapshot(picture: SkPicture, rect?: SkRect): SkImage | null {\n    if (!this.cachedImage) {\n      const renderResult = this.renderPictureToSurface(picture);\n      if (!renderResult) {\n        return null;\n      }\n\n      const { surface, tempCanvas } = renderResult;\n\n      try {\n        this.cachedImage = surface.makeImageSnapshot(dp2Pixel(this.pd, rect));\n      } catch (error) {\n        console.error(\"Error creating image snapshot:\", error);\n      } finally {\n        surface.ref.delete();\n        this.cleanupWebGLContext(tempCanvas);\n      }\n    }\n\n    return this.cachedImage;\n  }\n\n  dispose(): void {\n    this.cachedImage?.dispose();\n    this.cachedImage = null;\n  }\n}\n\nconst pd = Platform.PixelRatio;\n\nexport interface SkiaPictureViewHandle {\n  setPicture(picture: SkPicture): void;\n  getSize(): { width: number; height: number };\n  redraw(): void;\n  makeImageSnapshot(rect?: SkRect): SkImage | null;\n  measure(\n    callback: (\n      x: number,\n      y: number,\n      width: number,\n      height: number,\n      pageX: number,\n      pageY: number\n    ) => void\n  ): void;\n  measureInWindow(\n    callback: (x: number, y: number, width: number, height: number) => void\n  ): void;\n}\n\nexport interface SkiaPictureViewProps extends SkiaPictureViewNativeProps {\n  ref?: React.Ref<SkiaPictureViewHandle>;\n}\n\nexport const SkiaPictureView = (props: SkiaPictureViewProps) => {\n  const { ref } = props;\n  const canvasRef = useRef<HTMLCanvasElement | null>(null);\n  const renderer = useRef<Renderer | null>(null);\n  const redrawRequestsRef = useRef(0);\n  const requestIdRef = useRef(0);\n  const pictureRef = useRef<SkPicture | null>(null);\n\n  const { picture, onLayout } = props;\n\n  const redraw = useCallback(() => {\n    redrawRequestsRef.current++;\n  }, []);\n\n  const getSize = useCallback(() => {\n    return {\n      width: canvasRef.current?.clientWidth || 0,\n      height: canvasRef.current?.clientHeight || 0,\n    };\n  }, []);\n\n  const setPicture = useCallback(\n    (newPicture: SkPicture) => {\n      pictureRef.current = newPicture;\n      redraw();\n    },\n    [redraw]\n  );\n\n  const makeImageSnapshot = useCallback((rect?: SkRect) => {\n    if (renderer.current && pictureRef.current) {\n      return renderer.current.makeImageSnapshot(pictureRef.current, rect);\n    }\n    return null;\n  }, []);\n\n  const measure = useCallback(\n    (\n      callback: (\n        x: number,\n        y: number,\n        width: number,\n        height: number,\n        pageX: number,\n        pageY: number\n      ) => void\n    ) => {\n      if (canvasRef.current) {\n        const rect = canvasRef.current.getBoundingClientRect();\n        const parentElement = canvasRef.current.offsetParent as HTMLElement;\n        const parentRect = parentElement?.getBoundingClientRect() || {\n          left: 0,\n          top: 0,\n        };\n\n        // x, y are relative to the parent\n        const x = rect.left - parentRect.left;\n        const y = rect.top - parentRect.top;\n\n        // pageX, pageY are absolute screen coordinates\n        const pageX = rect.left + window.scrollX;\n        const pageY = rect.top + window.scrollY;\n\n        callback(x, y, rect.width, rect.height, pageX, pageY);\n      }\n    },\n    []\n  );\n\n  const measureInWindow = useCallback(\n    (\n      callback: (x: number, y: number, width: number, height: number) => void\n    ) => {\n      if (canvasRef.current) {\n        const rect = canvasRef.current.getBoundingClientRect();\n\n        // x, y are the absolute coordinates in the window\n        const x = rect.left;\n        const y = rect.top;\n\n        callback(x, y, rect.width, rect.height);\n      }\n    },\n    []\n  );\n\n  const tick = useCallback(() => {\n    if (redrawRequestsRef.current > 0) {\n      redrawRequestsRef.current = 0;\n      if (renderer.current && pictureRef.current) {\n        renderer.current.draw(pictureRef.current);\n      }\n    }\n    requestIdRef.current = requestAnimationFrame(tick);\n  }, []);\n\n  const onLayoutEvent = useCallback(\n    (evt: LayoutChangeEvent) => {\n      const canvas = canvasRef.current;\n      if (canvas) {\n        renderer.current =\n          props.__destroyWebGLContextAfterRender === true\n            ? new StaticWebGLRenderer(canvas, pd)\n            : new WebGLRenderer(canvas, pd);\n        if (pictureRef.current) {\n          renderer.current.draw(pictureRef.current);\n        }\n      }\n      if (onLayout) {\n        onLayout(evt);\n      }\n    },\n    [onLayout, props.__destroyWebGLContextAfterRender]\n  );\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      setPicture,\n      getSize,\n      redraw,\n      makeImageSnapshot,\n      measure,\n      measureInWindow,\n      get canvasRef() {\n        return () => canvasRef.current;\n      },\n    }),\n    [setPicture, getSize, redraw, makeImageSnapshot, measure, measureInWindow]\n  );\n\n  useEffect(() => {\n    const nativeID = props.nativeID ?? `${SkiaViewNativeId.current++}`;\n    (global.SkiaViewApi as ISkiaViewApiWeb).registerView(nativeID, {\n      setPicture,\n      getSize,\n      redraw,\n      makeImageSnapshot,\n      measure,\n      measureInWindow,\n    } as SkiaPictureViewHandle);\n  }, [\n    setPicture,\n    getSize,\n    redraw,\n    makeImageSnapshot,\n    measure,\n    measureInWindow,\n    props.nativeID,\n  ]);\n\n  useEffect(() => {\n    if (props.picture) {\n      setPicture(props.picture);\n    }\n  }, [setPicture, props.picture]);\n\n  useEffect(() => {\n    tick();\n    return () => {\n      cancelAnimationFrame(requestIdRef.current);\n      if (renderer.current) {\n        renderer.current.dispose();\n        renderer.current = null;\n      }\n    };\n  }, [tick]);\n\n  useEffect(() => {\n    if (renderer.current && pictureRef.current) {\n      renderer.current.draw(pictureRef.current);\n    }\n  }, [picture, redraw]);\n\n  const { debug = false, ref: _ref, ...viewProps } = props;\n  return (\n    <Platform.View {...viewProps} onLayout={onLayoutEvent}>\n      <canvas\n        ref={canvasRef}\n        style={{ display: \"block\", width: \"100%\", height: \"100%\" }}\n      />\n    </Platform.View>\n  );\n};\n"],"mappings":";;;;;;AACA,IAAAA,MAAA,GAAAC,uBAAA,CAAAC,OAAA;AASA,IAAAC,aAAA,GAAAD,OAAA;AACA,IAAAE,SAAA,GAAAF,OAAA;AAIA,IAAAG,iBAAA,GAAAH,OAAA;AAAsD,SAAAD,wBAAAK,CAAA,EAAAC,CAAA,6BAAAC,OAAA,MAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAP,uBAAA,YAAAA,CAAAK,CAAA,EAAAC,CAAA,SAAAA,CAAA,IAAAD,CAAA,IAAAA,CAAA,CAAAK,UAAA,SAAAL,CAAA,MAAAM,CAAA,EAAAC,CAAA,EAAAC,CAAA,KAAAC,SAAA,QAAAC,OAAA,EAAAV,CAAA,iBAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,SAAAQ,CAAA,MAAAF,CAAA,GAAAL,CAAA,GAAAG,CAAA,GAAAD,CAAA,QAAAG,CAAA,CAAAK,GAAA,CAAAX,CAAA,UAAAM,CAAA,CAAAM,GAAA,CAAAZ,CAAA,GAAAM,CAAA,CAAAO,GAAA,CAAAb,CAAA,EAAAQ,CAAA,gBAAAP,CAAA,IAAAD,CAAA,gBAAAC,CAAA,OAAAa,cAAA,CAAAC,IAAA,CAAAf,CAAA,EAAAC,CAAA,OAAAM,CAAA,IAAAD,CAAA,GAAAU,MAAA,CAAAC,cAAA,KAAAD,MAAA,CAAAE,wBAAA,CAAAlB,CAAA,EAAAC,CAAA,OAAAM,CAAA,CAAAK,GAAA,IAAAL,CAAA,CAAAM,GAAA,IAAAP,CAAA,CAAAE,CAAA,EAAAP,CAAA,EAAAM,CAAA,IAAAC,CAAA,CAAAP,CAAA,IAAAD,CAAA,CAAAC,CAAA,WAAAO,CAAA,KAAAR,CAAA,EAAAC,CAAA;AAAA,SAAAkB,SAAA,WAAAA,QAAA,GAAAH,MAAA,CAAAI,MAAA,GAAAJ,MAAA,CAAAI,MAAA,CAAAC,IAAA,eAAAjB,CAAA,aAAAJ,CAAA,MAAAA,CAAA,GAAAsB,SAAA,CAAAC,MAAA,EAAAvB,CAAA,UAAAC,CAAA,GAAAqB,SAAA,CAAAtB,CAAA,YAAAG,CAAA,IAAAF,CAAA,OAAAa,cAAA,CAAAC,IAAA,CAAAd,CAAA,EAAAE,CAAA,MAAAC,CAAA,CAAAD,CAAA,IAAAF,CAAA,CAAAE,CAAA,aAAAC,CAAA,KAAAe,QAAA,CAAAK,KAAA,OAAAF,SAAA;AAAA,SAAAG,gBAAAzB,CAAA,EAAAG,CAAA,EAAAF,CAAA,YAAAE,CAAA,GAAAuB,cAAA,CAAAvB,CAAA,MAAAH,CAAA,GAAAgB,MAAA,CAAAC,cAAA,CAAAjB,CAAA,EAAAG,CAAA,IAAAwB,KAAA,EAAA1B,CAAA,EAAA2B,UAAA,MAAAC,YAAA,MAAAC,QAAA,UAAA9B,CAAA,CAAAG,CAAA,IAAAF,CAAA,EAAAD,CAAA;AAAA,SAAA0B,eAAAzB,CAAA,QAAAM,CAAA,GAAAwB,YAAA,CAAA9B,CAAA,uCAAAM,CAAA,GAAAA,CAAA,GAAAA,CAAA;AAAA,SAAAwB,aAAA9B,CAAA,EAAAE,CAAA,2BAAAF,CAAA,KAAAA,CAAA,SAAAA,CAAA,MAAAD,CAAA,GAAAC,CAAA,CAAA+B,MAAA,CAAAC,WAAA,kBAAAjC,CAAA,QAAAO,CAAA,GAAAP,CAAA,CAAAe,IAAA,CAAAd,CAAA,EAAAE,CAAA,uCAAAI,CAAA,SAAAA,CAAA,YAAA2B,SAAA,yEAAA/B,CAAA,GAAAgC,MAAA,GAAAC,MAAA,EAAAnC,CAAA,KAftD;AAiBA,MAAMoC,QAAQ,GAAGA,CAACC,EAAU,EAAEC,IAAa,KAAK;EAC9C,IAAI,CAACA,IAAI,EAAE;IACT,OAAOC,SAAS;EAClB;EACA,OAAO;IACLC,CAAC,EAAEF,IAAI,CAACE,CAAC,GAAGH,EAAE;IACdI,CAAC,EAAEH,IAAI,CAACG,CAAC,GAAGJ,EAAE;IACdK,KAAK,EAAEJ,IAAI,CAACI,KAAK,GAAGL,EAAE;IACtBM,MAAM,EAAEL,IAAI,CAACK,MAAM,GAAGN;EACxB,CAAC;AACH,CAAC;AASD,MAAMO,aAAa,CAAqB;EAGtCC,WAAWA,CACDC,MAAyB,EACzBT,EAAU,EAClB;IAAA,KAFQS,MAAyB,GAAzBA,MAAyB;IAAA,KACzBT,EAAU,GAAVA,EAAU;IAAAb,eAAA,kBAJmB,IAAI;IAMzC,IAAI,CAACuB,QAAQ,CAAC,CAAC;EACjB;EAEAC,iBAAiBA,CAACC,OAAkB,EAAEX,IAAa,EAAkB;IACnE,IAAI,CAAC,IAAI,CAACY,OAAO,EAAE;MACjB,OAAO,IAAI;IACb;IACA,MAAMJ,MAAM,GAAG,IAAI,CAACI,OAAO,CAACC,SAAS,CAAC,CAAC;IACvCL,MAAM,CAAEM,KAAK,CAACC,SAAS,CAACC,WAAW,CAAC;IACpC,IAAI,CAACC,IAAI,CAACN,OAAO,CAAC;IAClB,IAAI,CAACC,OAAO,CAACM,GAAG,CAACC,KAAK,CAAC,CAAC;IACxB,OAAO,IAAI,CAACP,OAAO,CAACF,iBAAiB,CAACZ,QAAQ,CAAC,IAAI,CAACC,EAAE,EAAEC,IAAI,CAAC,CAAC;EAChE;EAEAS,QAAQA,CAAA,EAAG;IACT,MAAM;MAAED,MAAM;MAAET;IAAG,CAAC,GAAG,IAAI;IAC3BS,MAAM,CAACJ,KAAK,GAAGI,MAAM,CAACY,WAAW,GAAGrB,EAAE;IACtCS,MAAM,CAACH,MAAM,GAAGG,MAAM,CAACa,YAAY,GAAGtB,EAAE;IACxC,MAAMa,OAAO,GAAGG,SAAS,CAACO,sBAAsB,CAACd,MAAM,CAAC;IACxD,MAAMe,GAAG,GAAGf,MAAM,CAACgB,UAAU,CAAC,QAAQ,CAAC;IACvC,IAAID,GAAG,EAAE;MACPA,GAAG,CAACE,uBAAuB,GAAG,YAAY;IAC5C;IACA,IAAI,CAACb,OAAO,EAAE;MACZ,MAAM,IAAIc,KAAK,CAAC,0BAA0B,CAAC;IAC7C;IACA,IAAI,CAACd,OAAO,GAAG,IAAIe,0BAAY,CAACZ,SAAS,EAAEH,OAAO,CAAC;EACrD;EAEAK,IAAIA,CAACN,OAAkB,EAAE;IACvB,IAAI,IAAI,CAACC,OAAO,EAAE;MAChB,MAAMJ,MAAM,GAAG,IAAI,CAACI,OAAO,CAACC,SAAS,CAAC,CAAC;MACvCL,MAAM,CAACM,KAAK,CAACc,YAAY,CAACC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;MACzCrB,MAAM,CAACsB,IAAI,CAAC,CAAC;MACbtB,MAAM,CAACuB,KAAK,CAAChC,EAAE,EAAEA,EAAE,CAAC;MACpBS,MAAM,CAACwB,WAAW,CAACrB,OAAO,CAAC;MAC3BH,MAAM,CAACyB,OAAO,CAAC,CAAC;MAChB,IAAI,CAACrB,OAAO,CAACM,GAAG,CAACC,KAAK,CAAC,CAAC;IAC1B;EACF;EAEAe,OAAOA,CAAA,EAAS;IACd,IAAI,IAAI,CAACtB,OAAO,EAAE;MAAA,IAAAuB,YAAA;MAChB,CAAAA,YAAA,OAAI,CAAC3B,MAAM,cAAA2B,YAAA,gBAAAA,YAAA,GAAXA,YAAA,CACIX,UAAU,CAAC,QAAQ,CAAC,cAAAW,YAAA,gBAAAA,YAAA,GADxBA,YAAA,CAEIC,YAAY,CAAC,oBAAoB,CAAC,cAAAD,YAAA,eAFtCA,YAAA,CAGIE,WAAW,CAAC,CAAC;MACjB,IAAI,CAACzB,OAAO,CAACM,GAAG,CAACoB,MAAM,CAAC,CAAC;MACzB,IAAI,CAAC1B,OAAO,GAAG,IAAI;IACrB;EACF;AACF;AAEA,MAAM2B,mBAAmB,CAAqB;EAG5ChC,WAAWA,CACDC,MAAyB,EACzBT,EAAU,EAClB;IAAA,KAFQS,MAAyB,GAAzBA,MAAyB;IAAA,KACzBT,EAAU,GAAVA,EAAU;IAAAb,eAAA,sBAJkB,IAAI;EAKvC;EAEHuB,QAAQA,CAAA,EAAS;IACf,IAAI,CAAC+B,WAAW,GAAG,IAAI;EACzB;EAEQC,sBAAsBA,CAC5B9B,OAAkB,EAC6C;IAC/D,MAAM+B,UAAU,GAAG,IAAIC,eAAe,CACpC,IAAI,CAACnC,MAAM,CAACY,WAAW,GAAG,IAAI,CAACrB,EAAE,EACjC,IAAI,CAACS,MAAM,CAACa,YAAY,GAAG,IAAI,CAACtB,EAClC,CAAC;IAED,IAAIa,OAA4B,GAAG,IAAI;IAEvC,IAAI;MACF,MAAMgC,YAAY,GAAG7B,SAAS,CAACO,sBAAsB,CAACoB,UAAU,CAAC;MACjE,MAAMnB,GAAG,GAAGmB,UAAU,CAAClB,UAAU,CAAC,QAAQ,CAAC;MAC3C,IAAID,GAAG,EAAE;QACPA,GAAG,CAACE,uBAAuB,GAAG,YAAY;MAC5C;MAEA,IAAI,CAACmB,YAAY,EAAE;QACjB,MAAM,IAAIlB,KAAK,CAAC,gCAAgC,CAAC;MACnD;MAEAd,OAAO,GAAG,IAAIe,0BAAY,CAACZ,SAAS,EAAE6B,YAAY,CAAC;MAEnD,MAAMC,UAAU,GAAGjC,OAAO,CAACC,SAAS,CAAC,CAAC;MACtCgC,UAAU,CAAC/B,KAAK,CAACc,YAAY,CAACC,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;MAC7CgB,UAAU,CAACf,IAAI,CAAC,CAAC;MACjBe,UAAU,CAACd,KAAK,CAAC,IAAI,CAAChC,EAAE,EAAE,IAAI,CAACA,EAAE,CAAC;MAClC8C,UAAU,CAACb,WAAW,CAACrB,OAAO,CAAC;MAC/BkC,UAAU,CAACZ,OAAO,CAAC,CAAC;MACpBrB,OAAO,CAACM,GAAG,CAACC,KAAK,CAAC,CAAC;MAEnB,OAAO;QAAEP,OAAO;QAAE8B;MAAW,CAAC;IAChC,CAAC,CAAC,OAAOI,KAAK,EAAE;MACd,IAAIlC,OAAO,EAAE;QACXA,OAAO,CAACM,GAAG,CAACoB,MAAM,CAAC,CAAC;MACtB;MACA,IAAI,CAACS,mBAAmB,CAACL,UAAU,CAAC;MACpC,OAAO,IAAI;IACb;EACF;EAEQK,mBAAmBA,CAACL,UAA2B,EAAQ;IAC7D,MAAMnB,GAAG,GAAGmB,UAAU,CAAClB,UAAU,CAAC,QAAQ,CAAC;IAC3C,IAAID,GAAG,EAAE;MACP,MAAMc,WAAW,GAAGd,GAAG,CAACa,YAAY,CAAC,oBAAoB,CAAC;MAC1D,IAAIC,WAAW,EAAE;QACfA,WAAW,CAACA,WAAW,CAAC,CAAC;MAC3B;IACF;EACF;EAEApB,IAAIA,CAACN,OAAkB,EAAQ;IAC7B,MAAMqC,YAAY,GAAG,IAAI,CAACP,sBAAsB,CAAC9B,OAAO,CAAC;IACzD,IAAI,CAACqC,YAAY,EAAE;MACjB;IACF;IACA,MAAM;MAAEN;IAAW,CAAC,GAAGM,YAAY;IACnC,MAAMC,KAAK,GAAG,IAAI,CAACzC,MAAM,CAACgB,UAAU,CAAC,IAAI,CAAC;IAC1C,IAAI,CAACyB,KAAK,EAAE;MACV,MAAM,IAAIvB,KAAK,CAAC,0BAA0B,CAAC;IAC7C;;IAEA;IACA,IAAI,CAAClB,MAAM,CAACJ,KAAK,GAAG,IAAI,CAACI,MAAM,CAACY,WAAW,GAAG,IAAI,CAACrB,EAAE;IACrD,IAAI,CAACS,MAAM,CAACH,MAAM,GAAG,IAAI,CAACG,MAAM,CAACa,YAAY,GAAG,IAAI,CAACtB,EAAE;;IAEvD;IACAkD,KAAK,CAACC,SAAS,CACbR,UAAU,EACV,CAAC,EACD,CAAC,EACDA,UAAU,CAACtC,KAAK,EAChBsC,UAAU,CAACrC,MAAM,EACjB,CAAC,EACD,CAAC,EACD,IAAI,CAACG,MAAM,CAACY,WAAW,GAAG,IAAI,CAACrB,EAAE,EACjC,IAAI,CAACS,MAAM,CAACa,YAAY,GAAG,IAAI,CAACtB,EAClC,CAAC;IAED,IAAI,CAACgD,mBAAmB,CAACL,UAAU,CAAC;EACtC;EAEAhC,iBAAiBA,CAACC,OAAkB,EAAEX,IAAa,EAAkB;IACnE,IAAI,CAAC,IAAI,CAACwC,WAAW,EAAE;MACrB,MAAMQ,YAAY,GAAG,IAAI,CAACP,sBAAsB,CAAC9B,OAAO,CAAC;MACzD,IAAI,CAACqC,YAAY,EAAE;QACjB,OAAO,IAAI;MACb;MAEA,MAAM;QAAEpC,OAAO;QAAE8B;MAAW,CAAC,GAAGM,YAAY;MAE5C,IAAI;QACF,IAAI,CAACR,WAAW,GAAG5B,OAAO,CAACF,iBAAiB,CAACZ,QAAQ,CAAC,IAAI,CAACC,EAAE,EAAEC,IAAI,CAAC,CAAC;MACvE,CAAC,CAAC,OAAO8C,KAAK,EAAE;QACdK,OAAO,CAACL,KAAK,CAAC,gCAAgC,EAAEA,KAAK,CAAC;MACxD,CAAC,SAAS;QACRlC,OAAO,CAACM,GAAG,CAACoB,MAAM,CAAC,CAAC;QACpB,IAAI,CAACS,mBAAmB,CAACL,UAAU,CAAC;MACtC;IACF;IAEA,OAAO,IAAI,CAACF,WAAW;EACzB;EAEAN,OAAOA,CAAA,EAAS;IAAA,IAAAkB,iBAAA;IACd,CAAAA,iBAAA,OAAI,CAACZ,WAAW,cAAAY,iBAAA,eAAhBA,iBAAA,CAAkBlB,OAAO,CAAC,CAAC;IAC3B,IAAI,CAACM,WAAW,GAAG,IAAI;EACzB;AACF;AAEA,MAAMzC,EAAE,GAAGsD,kBAAQ,CAACC,UAAU;AA0BvB,MAAMC,eAAe,GAAIC,KAA2B,IAAK;EAC9D,MAAM;IAAEtC;EAAI,CAAC,GAAGsC,KAAK;EACrB,MAAMC,SAAS,GAAG,IAAAC,aAAM,EAA2B,IAAI,CAAC;EACxD,MAAMC,QAAQ,GAAG,IAAAD,aAAM,EAAkB,IAAI,CAAC;EAC9C,MAAME,iBAAiB,GAAG,IAAAF,aAAM,EAAC,CAAC,CAAC;EACnC,MAAMG,YAAY,GAAG,IAAAH,aAAM,EAAC,CAAC,CAAC;EAC9B,MAAMI,UAAU,GAAG,IAAAJ,aAAM,EAAmB,IAAI,CAAC;EAEjD,MAAM;IAAE/C,OAAO;IAAEoD;EAAS,CAAC,GAAGP,KAAK;EAEnC,MAAMQ,MAAM,GAAG,IAAAC,kBAAW,EAAC,MAAM;IAC/BL,iBAAiB,CAACM,OAAO,EAAE;EAC7B,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMC,OAAO,GAAG,IAAAF,kBAAW,EAAC,MAAM;IAAA,IAAAG,kBAAA,EAAAC,mBAAA;IAChC,OAAO;MACLjE,KAAK,EAAE,EAAAgE,kBAAA,GAAAX,SAAS,CAACS,OAAO,cAAAE,kBAAA,uBAAjBA,kBAAA,CAAmBhD,WAAW,KAAI,CAAC;MAC1Cf,MAAM,EAAE,EAAAgE,mBAAA,GAAAZ,SAAS,CAACS,OAAO,cAAAG,mBAAA,uBAAjBA,mBAAA,CAAmBhD,YAAY,KAAI;IAC7C,CAAC;EACH,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMiD,UAAU,GAAG,IAAAL,kBAAW,EAC3BM,UAAqB,IAAK;IACzBT,UAAU,CAACI,OAAO,GAAGK,UAAU;IAC/BP,MAAM,CAAC,CAAC;EACV,CAAC,EACD,CAACA,MAAM,CACT,CAAC;EAED,MAAMtD,iBAAiB,GAAG,IAAAuD,kBAAW,EAAEjE,IAAa,IAAK;IACvD,IAAI2D,QAAQ,CAACO,OAAO,IAAIJ,UAAU,CAACI,OAAO,EAAE;MAC1C,OAAOP,QAAQ,CAACO,OAAO,CAACxD,iBAAiB,CAACoD,UAAU,CAACI,OAAO,EAAElE,IAAI,CAAC;IACrE;IACA,OAAO,IAAI;EACb,CAAC,EAAE,EAAE,CAAC;EAEN,MAAMwE,OAAO,GAAG,IAAAP,kBAAW,EAEvBQ,QAOS,IACN;IACH,IAAIhB,SAAS,CAACS,OAAO,EAAE;MACrB,MAAMlE,IAAI,GAAGyD,SAAS,CAACS,OAAO,CAACQ,qBAAqB,CAAC,CAAC;MACtD,MAAMC,aAAa,GAAGlB,SAAS,CAACS,OAAO,CAACU,YAA2B;MACnE,MAAMC,UAAU,GAAG,CAAAF,aAAa,aAAbA,aAAa,uBAAbA,aAAa,CAAED,qBAAqB,CAAC,CAAC,KAAI;QAC3DI,IAAI,EAAE,CAAC;QACPC,GAAG,EAAE;MACP,CAAC;;MAED;MACA,MAAM7E,CAAC,GAAGF,IAAI,CAAC8E,IAAI,GAAGD,UAAU,CAACC,IAAI;MACrC,MAAM3E,CAAC,GAAGH,IAAI,CAAC+E,GAAG,GAAGF,UAAU,CAACE,GAAG;;MAEnC;MACA,MAAMC,KAAK,GAAGhF,IAAI,CAAC8E,IAAI,GAAGG,MAAM,CAACC,OAAO;MACxC,MAAMC,KAAK,GAAGnF,IAAI,CAAC+E,GAAG,GAAGE,MAAM,CAACG,OAAO;MAEvCX,QAAQ,CAACvE,CAAC,EAAEC,CAAC,EAAEH,IAAI,CAACI,KAAK,EAAEJ,IAAI,CAACK,MAAM,EAAE2E,KAAK,EAAEG,KAAK,CAAC;IACvD;EACF,CAAC,EACD,EACF,CAAC;EAED,MAAME,eAAe,GAAG,IAAApB,kBAAW,EAE/BQ,QAAuE,IACpE;IACH,IAAIhB,SAAS,CAACS,OAAO,EAAE;MACrB,MAAMlE,IAAI,GAAGyD,SAAS,CAACS,OAAO,CAACQ,qBAAqB,CAAC,CAAC;;MAEtD;MACA,MAAMxE,CAAC,GAAGF,IAAI,CAAC8E,IAAI;MACnB,MAAM3E,CAAC,GAAGH,IAAI,CAAC+E,GAAG;MAElBN,QAAQ,CAACvE,CAAC,EAAEC,CAAC,EAAEH,IAAI,CAACI,KAAK,EAAEJ,IAAI,CAACK,MAAM,CAAC;IACzC;EACF,CAAC,EACD,EACF,CAAC;EAED,MAAMiF,IAAI,GAAG,IAAArB,kBAAW,EAAC,MAAM;IAC7B,IAAIL,iBAAiB,CAACM,OAAO,GAAG,CAAC,EAAE;MACjCN,iBAAiB,CAACM,OAAO,GAAG,CAAC;MAC7B,IAAIP,QAAQ,CAACO,OAAO,IAAIJ,UAAU,CAACI,OAAO,EAAE;QAC1CP,QAAQ,CAACO,OAAO,CAACjD,IAAI,CAAC6C,UAAU,CAACI,OAAO,CAAC;MAC3C;IACF;IACAL,YAAY,CAACK,OAAO,GAAGqB,qBAAqB,CAACD,IAAI,CAAC;EACpD,CAAC,EAAE,EAAE,CAAC;EAEN,MAAME,aAAa,GAAG,IAAAvB,kBAAW,EAC9BwB,GAAsB,IAAK;IAC1B,MAAMjF,MAAM,GAAGiD,SAAS,CAACS,OAAO;IAChC,IAAI1D,MAAM,EAAE;MACVmD,QAAQ,CAACO,OAAO,GACdV,KAAK,CAACkC,gCAAgC,KAAK,IAAI,GAC3C,IAAInD,mBAAmB,CAAC/B,MAAM,EAAET,EAAE,CAAC,GACnC,IAAIO,aAAa,CAACE,MAAM,EAAET,EAAE,CAAC;MACnC,IAAI+D,UAAU,CAACI,OAAO,EAAE;QACtBP,QAAQ,CAACO,OAAO,CAACjD,IAAI,CAAC6C,UAAU,CAACI,OAAO,CAAC;MAC3C;IACF;IACA,IAAIH,QAAQ,EAAE;MACZA,QAAQ,CAAC0B,GAAG,CAAC;IACf;EACF,CAAC,EACD,CAAC1B,QAAQ,EAAEP,KAAK,CAACkC,gCAAgC,CACnD,CAAC;EAED,IAAAC,0BAAmB,EACjBzE,GAAG,EACH,OAAO;IACLoD,UAAU;IACVH,OAAO;IACPH,MAAM;IACNtD,iBAAiB;IACjB8D,OAAO;IACPa,eAAe;IACf,IAAI5B,SAASA,CAAA,EAAG;MACd,OAAO,MAAMA,SAAS,CAACS,OAAO;IAChC;EACF,CAAC,CAAC,EACF,CAACI,UAAU,EAAEH,OAAO,EAAEH,MAAM,EAAEtD,iBAAiB,EAAE8D,OAAO,EAAEa,eAAe,CAC3E,CAAC;EAED,IAAAO,gBAAS,EAAC,MAAM;IAAA,IAAAC,eAAA;IACd,MAAMC,QAAQ,IAAAD,eAAA,GAAGrC,KAAK,CAACsC,QAAQ,cAAAD,eAAA,cAAAA,eAAA,GAAI,GAAGE,kCAAgB,CAAC7B,OAAO,EAAE,EAAE;IACjE8B,MAAM,CAACC,WAAW,CAAqBC,YAAY,CAACJ,QAAQ,EAAE;MAC7DxB,UAAU;MACVH,OAAO;MACPH,MAAM;MACNtD,iBAAiB;MACjB8D,OAAO;MACPa;IACF,CAA0B,CAAC;EAC7B,CAAC,EAAE,CACDf,UAAU,EACVH,OAAO,EACPH,MAAM,EACNtD,iBAAiB,EACjB8D,OAAO,EACPa,eAAe,EACf7B,KAAK,CAACsC,QAAQ,CACf,CAAC;EAEF,IAAAF,gBAAS,EAAC,MAAM;IACd,IAAIpC,KAAK,CAAC7C,OAAO,EAAE;MACjB2D,UAAU,CAACd,KAAK,CAAC7C,OAAO,CAAC;IAC3B;EACF,CAAC,EAAE,CAAC2D,UAAU,EAAEd,KAAK,CAAC7C,OAAO,CAAC,CAAC;EAE/B,IAAAiF,gBAAS,EAAC,MAAM;IACdN,IAAI,CAAC,CAAC;IACN,OAAO,MAAM;MACXa,oBAAoB,CAACtC,YAAY,CAACK,OAAO,CAAC;MAC1C,IAAIP,QAAQ,CAACO,OAAO,EAAE;QACpBP,QAAQ,CAACO,OAAO,CAAChC,OAAO,CAAC,CAAC;QAC1ByB,QAAQ,CAACO,OAAO,GAAG,IAAI;MACzB;IACF,CAAC;EACH,CAAC,EAAE,CAACoB,IAAI,CAAC,CAAC;EAEV,IAAAM,gBAAS,EAAC,MAAM;IACd,IAAIjC,QAAQ,CAACO,OAAO,IAAIJ,UAAU,CAACI,OAAO,EAAE;MAC1CP,QAAQ,CAACO,OAAO,CAACjD,IAAI,CAAC6C,UAAU,CAACI,OAAO,CAAC;IAC3C;EACF,CAAC,EAAE,CAACvD,OAAO,EAAEqD,MAAM,CAAC,CAAC;EAErB,MAAM;IAAEoC,KAAK,GAAG,KAAK;IAAElF,GAAG,EAAEmF,IAAI;IAAE,GAAGC;EAAU,CAAC,GAAG9C,KAAK;EACxD,oBACErG,MAAA,CAAAgB,OAAA,CAAAoI,aAAA,CAAChJ,SAAA,CAAA8F,QAAQ,CAACmD,IAAI,EAAA5H,QAAA,KAAK0H,SAAS;IAAEvC,QAAQ,EAAEyB;EAAc,iBACpDrI,MAAA,CAAAgB,OAAA,CAAAoI,aAAA;IACErF,GAAG,EAAEuC,SAAU;IACfgD,KAAK,EAAE;MAAEC,OAAO,EAAE,OAAO;MAAEtG,KAAK,EAAE,MAAM;MAAEC,MAAM,EAAE;IAAO;EAAE,CAC5D,CACY,CAAC;AAEpB,CAAC;AAACsG,OAAA,CAAApD,eAAA,GAAAA,eAAA","ignoreList":[]}