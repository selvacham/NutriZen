{"version":3,"names":["_Host","require","_JsiSkColorFilter","_JsiSkImageFilter","_JsiSkMaskFilter","_JsiSkPathEffect","_JsiSkShader","kBlendModePlusDarker","kBlendModePlusLighter","plusDarkerSkSL","plusLighterSkSL","blenderCache","WeakMap","getBlenderCache","ck","cache","get","plusDarker","plusLighter","set","JsiSkPaint","HostObject","constructor","CanvasKit","ref","copy","assign","paint","reset","Paint","getAlphaf","getColor","getStrokeCap","value","getStrokeJoin","getStrokeMiter","getStrokeWidth","setAlphaf","alpha","setAntiAlias","aa","setDither","dither","setBlendMode","blendMode","effect","RuntimeEffect","MakeForBlender","makeBlender","setBlender","getEnum","setColor","color","setColorFilter","filter","JsiSkColorFilter","fromValue","setImageFilter","JsiSkImageFilter","setMaskFilter","JsiSkMaskFilter","setPathEffect","JsiSkPathEffect","setShader","shader","JsiSkShader","setStrokeCap","cap","setStrokeJoin","join","setStrokeMiter","limit","setStrokeWidth","width","setStyle","style","exports"],"sources":["JsiSkPaint.ts"],"sourcesContent":["import type { Blender, CanvasKit, Paint } from \"canvaskit-wasm\";\n\nimport type {\n  StrokeJoin,\n  BlendMode,\n  SkColor,\n  SkColorFilter,\n  SkImageFilter,\n  SkPaint,\n  SkShader,\n  StrokeCap,\n  PaintStyle,\n  SkMaskFilter,\n  SkPathEffect,\n} from \"../types\";\n\nimport { HostObject, getEnum } from \"./Host\";\nimport { JsiSkColorFilter } from \"./JsiSkColorFilter\";\nimport { JsiSkImageFilter } from \"./JsiSkImageFilter\";\nimport { JsiSkMaskFilter } from \"./JsiSkMaskFilter\";\nimport { JsiSkPathEffect } from \"./JsiSkPathEffect\";\nimport { JsiSkShader } from \"./JsiSkShader\";\n\n// Custom blend mode values (must match TypeScript BlendMode enum)\nconst kBlendModePlusDarker = 1001;\nconst kBlendModePlusLighter = 1002;\n\n// SkSL for PlusDarker blend mode\n// Formula: rc = max(0, 1 - ((1-dst) + (1-src))) = max(0, src + dst - 1)\nconst plusDarkerSkSL = `\n    vec4 main(vec4 src, vec4 dst) {\n        float outAlpha = src.a + dst.a - src.a * dst.a;\n        vec3 srcUnpremul = src.a > 0.0 ? src.rgb / src.a : vec3(0.0);\n        vec3 dstUnpremul = dst.a > 0.0 ? dst.rgb / dst.a : vec3(0.0);\n        vec3 blended = max(vec3(0.0), srcUnpremul + dstUnpremul - vec3(1.0));\n        return vec4(blended * outAlpha, outAlpha);\n    }\n`;\n\n// SkSL for PlusLighter blend mode\n// Formula: rc = min(1, dst + src)\nconst plusLighterSkSL = `\n    vec4 main(vec4 src, vec4 dst) {\n        float outAlpha = src.a + dst.a - src.a * dst.a;\n        vec3 srcUnpremul = src.a > 0.0 ? src.rgb / src.a : vec3(0.0);\n        vec3 dstUnpremul = dst.a > 0.0 ? dst.rgb / dst.a : vec3(0.0);\n        vec3 blended = min(vec3(1.0), srcUnpremul + dstUnpremul);\n        return vec4(blended * outAlpha, outAlpha);\n    }\n`;\n\n// Cache for custom blenders per CanvasKit instance\n// Using WeakMap ensures blenders are cleaned up when CanvasKit instance is garbage collected\ninterface BlenderCache {\n  plusDarker: Blender | null;\n  plusLighter: Blender | null;\n}\nconst blenderCache = new WeakMap<CanvasKit, BlenderCache>();\n\nconst getBlenderCache = (ck: CanvasKit): BlenderCache => {\n  let cache = blenderCache.get(ck);\n  if (!cache) {\n    cache = { plusDarker: null, plusLighter: null };\n    blenderCache.set(ck, cache);\n  }\n  return cache;\n};\n\nexport class JsiSkPaint extends HostObject<Paint, \"Paint\"> implements SkPaint {\n  constructor(CanvasKit: CanvasKit, ref: Paint) {\n    super(CanvasKit, ref, \"Paint\");\n  }\n\n  copy() {\n    return new JsiSkPaint(this.CanvasKit, this.ref.copy());\n  }\n\n  assign(paint: JsiSkPaint) {\n    this.ref = paint.ref.copy();\n  }\n\n  reset() {\n    this.ref = new this.CanvasKit.Paint();\n  }\n\n  getAlphaf() {\n    return this.getColor()[3];\n  }\n\n  getColor() {\n    return this.ref.getColor();\n  }\n\n  getStrokeCap() {\n    return this.ref.getStrokeCap().value;\n  }\n\n  getStrokeJoin() {\n    return this.ref.getStrokeJoin().value;\n  }\n\n  getStrokeMiter() {\n    return this.ref.getStrokeMiter();\n  }\n\n  getStrokeWidth() {\n    return this.ref.getStrokeWidth();\n  }\n\n  setAlphaf(alpha: number) {\n    this.ref.setAlphaf(alpha);\n  }\n\n  setAntiAlias(aa: boolean) {\n    this.ref.setAntiAlias(aa);\n  }\n\n  setDither(dither: boolean) {\n    this.ref.setDither(dither);\n  }\n\n  setBlendMode(blendMode: BlendMode) {\n    if (blendMode === kBlendModePlusDarker) {\n      // Use custom PlusDarker blender via SkRuntimeEffect\n      const cache = getBlenderCache(this.CanvasKit);\n      if (!cache.plusDarker) {\n        const effect =\n          this.CanvasKit.RuntimeEffect.MakeForBlender(plusDarkerSkSL);\n        if (effect) {\n          cache.plusDarker = effect.makeBlender([]);\n        }\n      }\n      if (cache.plusDarker) {\n        this.ref.setBlender(cache.plusDarker);\n      }\n    } else if (blendMode === kBlendModePlusLighter) {\n      // Use custom PlusLighter blender via SkRuntimeEffect\n      const cache = getBlenderCache(this.CanvasKit);\n      if (!cache.plusLighter) {\n        const effect =\n          this.CanvasKit.RuntimeEffect.MakeForBlender(plusLighterSkSL);\n        if (effect) {\n          cache.plusLighter = effect.makeBlender([]);\n        }\n      }\n      if (cache.plusLighter) {\n        this.ref.setBlender(cache.plusLighter);\n      }\n    } else {\n      this.ref.setBlendMode(getEnum(this.CanvasKit, \"BlendMode\", blendMode));\n    }\n  }\n\n  setColor(color: SkColor) {\n    this.ref.setColor(color);\n  }\n\n  setColorFilter(filter: SkColorFilter | null) {\n    this.ref.setColorFilter(filter ? JsiSkColorFilter.fromValue(filter) : null);\n  }\n\n  setImageFilter(filter: SkImageFilter | null) {\n    this.ref.setImageFilter(filter ? JsiSkImageFilter.fromValue(filter) : null);\n  }\n\n  setMaskFilter(filter: SkMaskFilter | null) {\n    this.ref.setMaskFilter(filter ? JsiSkMaskFilter.fromValue(filter) : null);\n  }\n\n  setPathEffect(effect: SkPathEffect | null) {\n    this.ref.setPathEffect(effect ? JsiSkPathEffect.fromValue(effect) : null);\n  }\n\n  setShader(shader: SkShader | null) {\n    this.ref.setShader(shader ? JsiSkShader.fromValue(shader) : null);\n  }\n\n  setStrokeCap(cap: StrokeCap) {\n    this.ref.setStrokeCap(getEnum(this.CanvasKit, \"StrokeCap\", cap));\n  }\n\n  setStrokeJoin(join: StrokeJoin) {\n    this.ref.setStrokeJoin(getEnum(this.CanvasKit, \"StrokeJoin\", join));\n  }\n\n  setStrokeMiter(limit: number) {\n    this.ref.setStrokeMiter(limit);\n  }\n\n  setStrokeWidth(width: number) {\n    this.ref.setStrokeWidth(width);\n  }\n\n  setStyle(style: PaintStyle) {\n    this.ref.setStyle({ value: style });\n  }\n}\n"],"mappings":";;;;;;AAgBA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,iBAAA,GAAAD,OAAA;AACA,IAAAE,iBAAA,GAAAF,OAAA;AACA,IAAAG,gBAAA,GAAAH,OAAA;AACA,IAAAI,gBAAA,GAAAJ,OAAA;AACA,IAAAK,YAAA,GAAAL,OAAA;AAEA;AACA,MAAMM,oBAAoB,GAAG,IAAI;AACjC,MAAMC,qBAAqB,GAAG,IAAI;;AAElC;AACA;AACA,MAAMC,cAAc,GAAG;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA,MAAMC,eAAe,GAAG;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;;AAKA,MAAMC,YAAY,GAAG,IAAIC,OAAO,CAA0B,CAAC;AAE3D,MAAMC,eAAe,GAAIC,EAAa,IAAmB;EACvD,IAAIC,KAAK,GAAGJ,YAAY,CAACK,GAAG,CAACF,EAAE,CAAC;EAChC,IAAI,CAACC,KAAK,EAAE;IACVA,KAAK,GAAG;MAAEE,UAAU,EAAE,IAAI;MAAEC,WAAW,EAAE;IAAK,CAAC;IAC/CP,YAAY,CAACQ,GAAG,CAACL,EAAE,EAAEC,KAAK,CAAC;EAC7B;EACA,OAAOA,KAAK;AACd,CAAC;AAEM,MAAMK,UAAU,SAASC,gBAAU,CAAoC;EAC5EC,WAAWA,CAACC,SAAoB,EAAEC,GAAU,EAAE;IAC5C,KAAK,CAACD,SAAS,EAAEC,GAAG,EAAE,OAAO,CAAC;EAChC;EAEAC,IAAIA,CAAA,EAAG;IACL,OAAO,IAAIL,UAAU,CAAC,IAAI,CAACG,SAAS,EAAE,IAAI,CAACC,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC;EACxD;EAEAC,MAAMA,CAACC,KAAiB,EAAE;IACxB,IAAI,CAACH,GAAG,GAAGG,KAAK,CAACH,GAAG,CAACC,IAAI,CAAC,CAAC;EAC7B;EAEAG,KAAKA,CAAA,EAAG;IACN,IAAI,CAACJ,GAAG,GAAG,IAAI,IAAI,CAACD,SAAS,CAACM,KAAK,CAAC,CAAC;EACvC;EAEAC,SAASA,CAAA,EAAG;IACV,OAAO,IAAI,CAACC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;EAC3B;EAEAA,QAAQA,CAAA,EAAG;IACT,OAAO,IAAI,CAACP,GAAG,CAACO,QAAQ,CAAC,CAAC;EAC5B;EAEAC,YAAYA,CAAA,EAAG;IACb,OAAO,IAAI,CAACR,GAAG,CAACQ,YAAY,CAAC,CAAC,CAACC,KAAK;EACtC;EAEAC,aAAaA,CAAA,EAAG;IACd,OAAO,IAAI,CAACV,GAAG,CAACU,aAAa,CAAC,CAAC,CAACD,KAAK;EACvC;EAEAE,cAAcA,CAAA,EAAG;IACf,OAAO,IAAI,CAACX,GAAG,CAACW,cAAc,CAAC,CAAC;EAClC;EAEAC,cAAcA,CAAA,EAAG;IACf,OAAO,IAAI,CAACZ,GAAG,CAACY,cAAc,CAAC,CAAC;EAClC;EAEAC,SAASA,CAACC,KAAa,EAAE;IACvB,IAAI,CAACd,GAAG,CAACa,SAAS,CAACC,KAAK,CAAC;EAC3B;EAEAC,YAAYA,CAACC,EAAW,EAAE;IACxB,IAAI,CAAChB,GAAG,CAACe,YAAY,CAACC,EAAE,CAAC;EAC3B;EAEAC,SAASA,CAACC,MAAe,EAAE;IACzB,IAAI,CAAClB,GAAG,CAACiB,SAAS,CAACC,MAAM,CAAC;EAC5B;EAEAC,YAAYA,CAACC,SAAoB,EAAE;IACjC,IAAIA,SAAS,KAAKrC,oBAAoB,EAAE;MACtC;MACA,MAAMQ,KAAK,GAAGF,eAAe,CAAC,IAAI,CAACU,SAAS,CAAC;MAC7C,IAAI,CAACR,KAAK,CAACE,UAAU,EAAE;QACrB,MAAM4B,MAAM,GACV,IAAI,CAACtB,SAAS,CAACuB,aAAa,CAACC,cAAc,CAACtC,cAAc,CAAC;QAC7D,IAAIoC,MAAM,EAAE;UACV9B,KAAK,CAACE,UAAU,GAAG4B,MAAM,CAACG,WAAW,CAAC,EAAE,CAAC;QAC3C;MACF;MACA,IAAIjC,KAAK,CAACE,UAAU,EAAE;QACpB,IAAI,CAACO,GAAG,CAACyB,UAAU,CAAClC,KAAK,CAACE,UAAU,CAAC;MACvC;IACF,CAAC,MAAM,IAAI2B,SAAS,KAAKpC,qBAAqB,EAAE;MAC9C;MACA,MAAMO,KAAK,GAAGF,eAAe,CAAC,IAAI,CAACU,SAAS,CAAC;MAC7C,IAAI,CAACR,KAAK,CAACG,WAAW,EAAE;QACtB,MAAM2B,MAAM,GACV,IAAI,CAACtB,SAAS,CAACuB,aAAa,CAACC,cAAc,CAACrC,eAAe,CAAC;QAC9D,IAAImC,MAAM,EAAE;UACV9B,KAAK,CAACG,WAAW,GAAG2B,MAAM,CAACG,WAAW,CAAC,EAAE,CAAC;QAC5C;MACF;MACA,IAAIjC,KAAK,CAACG,WAAW,EAAE;QACrB,IAAI,CAACM,GAAG,CAACyB,UAAU,CAAClC,KAAK,CAACG,WAAW,CAAC;MACxC;IACF,CAAC,MAAM;MACL,IAAI,CAACM,GAAG,CAACmB,YAAY,CAAC,IAAAO,aAAO,EAAC,IAAI,CAAC3B,SAAS,EAAE,WAAW,EAAEqB,SAAS,CAAC,CAAC;IACxE;EACF;EAEAO,QAAQA,CAACC,KAAc,EAAE;IACvB,IAAI,CAAC5B,GAAG,CAAC2B,QAAQ,CAACC,KAAK,CAAC;EAC1B;EAEAC,cAAcA,CAACC,MAA4B,EAAE;IAC3C,IAAI,CAAC9B,GAAG,CAAC6B,cAAc,CAACC,MAAM,GAAGC,kCAAgB,CAACC,SAAS,CAACF,MAAM,CAAC,GAAG,IAAI,CAAC;EAC7E;EAEAG,cAAcA,CAACH,MAA4B,EAAE;IAC3C,IAAI,CAAC9B,GAAG,CAACiC,cAAc,CAACH,MAAM,GAAGI,kCAAgB,CAACF,SAAS,CAACF,MAAM,CAAC,GAAG,IAAI,CAAC;EAC7E;EAEAK,aAAaA,CAACL,MAA2B,EAAE;IACzC,IAAI,CAAC9B,GAAG,CAACmC,aAAa,CAACL,MAAM,GAAGM,gCAAe,CAACJ,SAAS,CAACF,MAAM,CAAC,GAAG,IAAI,CAAC;EAC3E;EAEAO,aAAaA,CAAChB,MAA2B,EAAE;IACzC,IAAI,CAACrB,GAAG,CAACqC,aAAa,CAAChB,MAAM,GAAGiB,gCAAe,CAACN,SAAS,CAACX,MAAM,CAAC,GAAG,IAAI,CAAC;EAC3E;EAEAkB,SAASA,CAACC,MAAuB,EAAE;IACjC,IAAI,CAACxC,GAAG,CAACuC,SAAS,CAACC,MAAM,GAAGC,wBAAW,CAACT,SAAS,CAACQ,MAAM,CAAC,GAAG,IAAI,CAAC;EACnE;EAEAE,YAAYA,CAACC,GAAc,EAAE;IAC3B,IAAI,CAAC3C,GAAG,CAAC0C,YAAY,CAAC,IAAAhB,aAAO,EAAC,IAAI,CAAC3B,SAAS,EAAE,WAAW,EAAE4C,GAAG,CAAC,CAAC;EAClE;EAEAC,aAAaA,CAACC,IAAgB,EAAE;IAC9B,IAAI,CAAC7C,GAAG,CAAC4C,aAAa,CAAC,IAAAlB,aAAO,EAAC,IAAI,CAAC3B,SAAS,EAAE,YAAY,EAAE8C,IAAI,CAAC,CAAC;EACrE;EAEAC,cAAcA,CAACC,KAAa,EAAE;IAC5B,IAAI,CAAC/C,GAAG,CAAC8C,cAAc,CAACC,KAAK,CAAC;EAChC;EAEAC,cAAcA,CAACC,KAAa,EAAE;IAC5B,IAAI,CAACjD,GAAG,CAACgD,cAAc,CAACC,KAAK,CAAC;EAChC;EAEAC,QAAQA,CAACC,KAAiB,EAAE;IAC1B,IAAI,CAACnD,GAAG,CAACkD,QAAQ,CAAC;MAAEzC,KAAK,EAAE0C;IAAM,CAAC,CAAC;EACrC;AACF;AAACC,OAAA,CAAAxD,UAAA,GAAAA,UAAA","ignoreList":[]}